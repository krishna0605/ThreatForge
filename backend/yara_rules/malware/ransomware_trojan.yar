rule ransomware_indicators
{
    meta:
        author = "ThreatForge"
        description = "Detects common ransomware indicators"
        severity = "critical"
        category = "malware"

    strings:
        $ransom1 = "Your files have been encrypted" ascii nocase wide
        $ransom2 = "bitcoin" ascii nocase wide
        $ransom3 = "wallet address" ascii nocase wide
        $ransom4 = ".onion" ascii nocase
        $ransom5 = "decrypt" ascii nocase wide
        $crypto1 = "CryptEncrypt" ascii
        $crypto2 = "CryptGenKey" ascii
        $crypto3 = "BCryptEncrypt" ascii
        $ext1 = ".locked" ascii nocase
        $ext2 = ".encrypted" ascii nocase
        $ext3 = ".crypto" ascii nocase

    condition:
        uint16(0) == 0x5A4D and (
            (2 of ($ransom*) and 1 of ($crypto*)) or
            (1 of ($ransom*) and 2 of ($crypto*) and 1 of ($ext*))
        )
}

rule trojan_dropper
{
    meta:
        author = "ThreatForge"
        description = "Detects common dropper/downloader patterns"
        severity = "high"
        category = "malware"

    strings:
        $dl1 = "URLDownloadToFile" ascii
        $dl2 = "InternetOpen" ascii
        $dl3 = "HttpSendRequest" ascii
        $dl4 = "WinHttpOpen" ascii
        $exec1 = "WinExec" ascii
        $exec2 = "CreateProcess" ascii
        $exec3 = "ShellExecute" ascii
        $tmp = "%TEMP%" ascii nocase

    condition:
        uint16(0) == 0x5A4D and (2 of ($dl*)) and (1 of ($exec*)) and $tmp
}

rule keylogger_indicators
{
    meta:
        author = "ThreatForge"
        description = "Detects potential keylogger functionality"
        severity = "high"
        category = "malware"

    strings:
        $hook1 = "SetWindowsHookEx" ascii
        $hook2 = "GetAsyncKeyState" ascii
        $hook3 = "GetKeyState" ascii
        $hook4 = "GetKeyboardState" ascii
        $log1 = "keylog" ascii nocase
        $log2 = "keystroke" ascii nocase
        $clip = "GetClipboardData" ascii

    condition:
        uint16(0) == 0x5A4D and (2 of ($hook*) or (1 of ($hook*) and 1 of ($log*)) or ($clip and 1 of ($hook*)))
}
