"""Malware Prediction Logic"""
import numpy as np
from typing import Dict, Any, List


class MalwarePredictor:
    """Malware classification using trained ML model."""

    def __init__(self, model):
        self.model = model
        self.labels = ['clean', 'adware', 'trojan', 'ransomware', 'worm', 'spyware']

    def predict(self, features: List[float]) -> Dict[str, Any]:
        """
        Predict malware classification.

        Args:
            features: List of extracted PE/byte features

        Returns:
            Dict with prediction, confidence, and label
        """
        if self.model is None:
            return {'prediction': 'unknown', 'confidence': 0.0}

        features_array = np.array(features).reshape(1, -1)
        prediction = self.model.predict(features_array)[0]
        probabilities = self.model.predict_proba(features_array)[0]

        return {
            'prediction': str(prediction),
            'confidence': float(np.max(probabilities)),
            'label': self.labels[int(prediction)] if isinstance(prediction, (int, np.integer)) else str(prediction),
            'probabilities': {self.labels[i]: float(p) for i, p in enumerate(probabilities) if i < len(self.labels)},
        }
